---
# front matter tells Jekyll to process Liquid
---
<!DOCTYPE html>
<html class=" js no-touch svg inlinesvg svgclippaths no-ie8compat" style="">
	{% include head.html %}
	<body class="homepage homepage_index">
		{% include header.html %}
		<main class="content container" role="main">
			<div class="content-row">
				{% include nav.html %}
				<article class="inner-content">
					<div class="inner-content">
						<h1 id="the-chair-of-br-network-architectures-and-services">Figure 5</h1>

						<h5>Bursts with #32-batching, Snort-filter (VM)</h5>
						<p><img src="{{site.url}}/figures/burst-32batch/vm/pcap/latencies-pre-rate10000-snort-filter.pdf.svg" style="display:block;margin-left:auto;margin-right:auto;width=90%;" alt="low-latency/figures/burst-32batch/vm/pcap/latencies-pre-rate10000-snort-filter.pdf.svg"/></p>
						<h5>Bursts with #4-batching, Snort-filter (VM)</h5>
						<p><img src="{{site.url}}/figures/burst-4batch/vm/pcap/latencies-pre-rate10000-snort-filter.pdf.svg" style="display:block;margin-left:auto;margin-right:auto;width=90%;" alt="low-latency/figures/burst-4batch/vm/pcap/latencies-pre-rate10000-snort-filter.pdf.svg"/></p>

						<h2 style="margin: 30px 0 15px 0;">Steps to reproduce measurements</h2>

						<h3>Images</h3>
						<p>Images used for testing</p>
						<p>
						<details>
							<summary>Loadgen, timestamper</summary>
							{% include debian_stretch_default.html %}
						</details>

						<details>
							<summary>Device under test (VM host and VM)</summary>
							{% include debian_buster_rt.html %}
						</details>
						<details>
							<summary>Evaluator</summary>
							{% include debian_buster_default.html %}
						</details>
						</p>

						<h3>Setup</h3>
						<p>
						<details>
							<summary>Setup loadgen</summary>
							{% include loadgen_setup.html %}
						</details>
						</p>

						<p style="margin-bottom:0px;">
						Configuration VM: setup device under test (DuT) for Snort-filter:
						</p>
						<div style="margin-top:0px; margin-left:16px;">
							<details>
								<summary>Boot parameter VM host</summary>
								{% include vm_host_bootparam_optimized.html %}
							</details>

							<details>
								<summary>Setup VM host</summary>
								{% include setup_vm_host_optimized.html %}
							</details>

							<details>
								<summary>Cache partitioning VM host</summary>
								{% include cat_setup_vm.html %}
							</details>

							<details>
								<summary>Boot parameter VM</summary>
								{% include vm_bootparam_optimized.html %}
							</details>

							<div style="margin-left:16px;">
								<details>
									<summary>Var A: Setup VM Snort #32 batching</summary>
									{% include dpdk_snort_setup.html %}
								</details>
								<details>
									<summary>Var B: Setup VM Snort #4 batching</summary>
									{% include dpdk_snort_setup_4batch.html %}
								</details>
							</div>
						</div>

						<p>
						<details>
							<summary>Setup timestamper</summary>
							{% include timestamper_setup.html %}
						</details>
						</p>

						<h3>Experiment execution</h3>
						<p>1. Start Snort-filter on the DuT:
						<details>
							<summary>Snort-filter</summary>
							<p><pre><code>taskset -c 1 /opt/snort/bin/snort -c "/root/low-latency/config/snort-community-rules.lua" --daq-dir /opt/snort/lib/daq --daq dpdk --daq-var dpdk_argc="-n1" -i "dpdk0:dpdk1" -Q -z 1'</pre></code></p>
						</details>
						</p>

						<p>2. Wait until forwarder has been started, then start MoonGen on the LoadGen:
						<details>
							<summary>Start MoonGen</summary>
							<p><pre><code># $RATE is the number of generated packets per second
# $PACKETS is the number of packets to be generated
# $BURST amount of packets in a burst on the wire
/root/moongen/build/MoonGen /root/moongen/examples/moonsniff/traffic-gen.lua --src-mac 52:54:00:8d:9d:ad --dst-mac 52:54:00:21:f8:29 --fix-packetrate  --packets $PACKETS --warm-up 30 --l4-dst 53 --flows 10 --burst $BURST 1 0</pre></code></p>
						</details>
						</p>

						<p>3. After Moongen on the LoadGen has been started 1000 packets are sent to warm up the DuT. After that packet generation is paused for 30 seconds. In this pause MoonGen's packet sniffer on the timestamper should be started to record the actual measurement:
						<details>
							<summary>Start MoonGen</summary>
							<p><pre><code>/root/moongen/build/MoonGen /root/moongen/examples/moonsniff/sniffer.lua 1 0 --capture --time 45 --snaplen 256</pre></code></p>
						</details>
						</p>

						<p>4. The timestamper stops recording after 45 seconds and creates the two pcap files latencies-pre.pcap and latencies-post.pcap which can be used for evaluation.</p>

						<h2 style="margin: 30px 0 15px 0;">Steps to reproduce figures</h2>
						<h3>Raw data</h3>
						<p>Pcaps (<a href="https://github.com/gallenmu/low-latency/tree/master/measurements/burst-batch/vm/pcap">Snort-filter #32-batch (VM)</a>, <a href="https://github.com/gallenmu/low-latency/tree/master/measurements/burst-nobatch/vm/pcap">Snort-filter #4-batch (VM)</a>)</p>

						<h3>Evaluation execution</h3>
						<p><details>
							<summary>Setup evaluator</summary>
							{% include evaluator_setup.html %}
						</details>
						<details>
							<summary>Generate figures</summary>
							<p><pre><code>git clone https://github.com/gallenmu/low-latency /root/low-latency

#decompress pcaps
cd /root/low-latency/measurements
for i in $(find . -iname *.zst); do zstd --rm -d $i; done;

#create figures for batch size #32
cd /root/low-latency/figures/burst-32batch/vm/pcap
su postgres -c "createuser -s root"
dropdb --if-exists root
createdb root
export PGDATABASE=root
for i in /root/low-latency/measurements/burst-32batch/vm/pcap/*-pre-*.pcap; do /root/low-latency/scripts/pcap-import.sh $i; /root/low-latency/scripts/pcap-analysis.sh $i; done;
python3 /root/low-latency/scripts/burst-tex-create.py .
for i in *.tex; do lualatex $i; done

#create figures for batch size #4
cd /root/low-latency/figures/burst-4batch/vm/pcap
su postgres -c "createuser -s root"
dropdb --if-exists root
createdb root
export PGDATABASE=root
for i in /root/low-latency/measurements/burst-4batch/vm/pcap/*-pre-*.pcap; do /root/low-latency/scripts/pcap-import.sh $i; /root/low-latency/scripts/pcap-analysis.sh $i; done;
python3 /root/low-latency/scripts/burst-tex-create.py .
for i in *.tex; do lualatex $i; done</code></pre></p>
</details></p>

						<h3>Output</h3>
						<p>The precompiled output files can be found in the respective subfolders the <a href="https://github.com/gallenmu/low-latency/tree/master/figures/burst-32batch/vm/pcap">burst-32batch folder</a> and <a href="https://github.com/gallenmu/low-latency/tree/master/figures/burst-4batch/vm/pcap">burst-4batch folder</a>.</p>
					</div>
				</article>
			</div>
		</main>
		{% include footer.html %}
	</body></html>
